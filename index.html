<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#0f172a">
    <link rel="manifest" href="manifest.json">
    <title>PORTO</title>
    <style>
        :root { --bg: #0f172a; --card: #1e293b; --accent: #38bdf8; --text: #f8fafc; --subtext: #94a3b8; --up: #4ade80; --down: #f87171; }
        * { box-sizing: border-box; font-family: 'Segoe UI', sans-serif; -webkit-tap-highlight-color: transparent; }
        
        /* Layout Dasar Baru (Gaya Tracker) */
        html, body { background: var(--bg); color: var(--text); margin: 0; padding: 0; min-height: 100%; }
        .container { width: 100%; max-width: 420px; margin: 0 auto; display: flex; flex-direction: column; }

        /* 1. BAGIAN ATAS - Bisa Tenggelam */
        .top-flow { padding: 15px 15px 5px 15px; background: var(--bg); }
        .header { display: flex; justify-content: space-between; align-items: center; }
        .brand { font-size: 18px; font-weight: bold; color: var(--accent); }
        .kurs-info { font-size: 9px; color: var(--subtext); background: rgba(255,255,255,0.05); padding: 3px 6px; border-radius: 8px; border: 1px solid #334155; }

        /* 2. STICKY HEADER - Ngunci di Atas */
        .sticky-header { position: sticky; top: 0; z-index: 100; background: var(--bg); padding: 5px 15px 10px 15px; }
        .summary-card { background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); border-radius: 12px; padding: 12px; margin-bottom: 10px; border: 1px solid var(--accent); text-align: center; }
        .summary-idr { font-size: 20px; font-weight: 800; display: block; }
        #total-all-usd { color: var(--subtext); font-size: 12px; }

        .tab-container { display: flex; gap: 8px; margin-bottom: 10px; background: rgba(255,255,255,0.05); padding: 4px; border-radius: 10px; border: 1px solid #334155; }
        .tab-btn { flex: 1; padding: 8px; border-radius: 6px; border: none; background: transparent; color: var(--subtext); cursor: pointer; font-weight: bold; font-size: 12px; transition: 0.3s; }
        .tab-btn.active { background: var(--accent); color: #0f172a; }
        
        .filter-input { width: 100%; background: rgba(255,255,255,0.05); border: 1px solid #334155; border-radius: 10px; padding: 10px 12px; color: white; outline: none; font-size: 13px; margin-bottom: 8px; }
        
        .control-row { display: flex; justify-content: space-between; gap: 6px; }
        .control-select { background: var(--card); color: white; border: 1px solid #334155; border-radius: 6px; font-size: 10px; padding: 6px; outline: none; cursor: pointer; flex: 1; }

        /* 3. AREA LIST */
        #main-list { padding: 10px 15px; min-height: 200px; }

        /* 4. STICKY FOOTER - Ngunci di Bawah */
        .sticky-footer { position: sticky; bottom: 0; z-index: 100; background: var(--bg); padding: 10px 15px 15px 15px; border-top: 1px solid rgba(255,255,255,0.05); }
        .search-box { display: flex; gap: 6px; }
        .search-box input { flex: 1; background: var(--card); border: 1px solid #334155; color: white; padding: 10px; border-radius: 8px; outline: none; font-size: 13px; }
        .add-btn { background: var(--accent); border: none; padding: 0 12px; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 12px; color: #0f172a; }

        /* 5. BOTTOM FLOW - Bisa Tenggelam ke Bawah */
        .bottom-flow { padding: 5px 15px 25px 15px; background: var(--bg); }
        .backup-section { display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: 10px; }
        .backup-btn { flex: 1 1 calc(50% - 3px); background: transparent; border: 1px solid #334155; color: var(--subtext); padding: 8px; border-radius: 6px; font-size: 11px; cursor: pointer; text-align: center; }
        .import-btn-full { flex: 1 1 100% !important; border: 1px solid var(--accent) !important; color: var(--accent) !important; }
        .update-info { font-size: 9px; color: var(--subtext); text-align: center; opacity: 0.6; }

        /* Styling Item dari TES4 (Input gede & pas) */
        .coin-row { position: relative; margin-bottom: 8px; }
        .coin-card { background: var(--card); border-radius: 10px; padding: 10px; display: flex; align-items: center; gap: 10px; border: 1px solid #334155; cursor: pointer; position: relative; z-index: 2; user-select: none; }
        .logo-wrapper { width: 32px; height: 32px; border-radius: 50%; overflow: hidden; border: 1px solid #475569; flex-shrink: 0; background: #000; display: flex; align-items: center; justify-content: center; }
        .logo-wrapper img { width: 100%; height: 100%; object-fit: cover; }
        .logo-initial { width: 100%; height: 100%; background: #000; color: #fff; display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: bold; text-transform: uppercase; border: 1px solid #475569; border-radius: 50%; }
        .info-group { flex: 1; min-width: 0; }
        .symbol { font-size: 14px; font-weight: bold; text-transform: uppercase; }
        .change-pct { font-size: 9px; font-weight: bold; margin-left: 4px; }
        .up { color: var(--up); }
        .down { color: var(--down); }
        
        .modal-overlay { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); z-index: 2000; align-items: center; justify-content: center; padding: 20px; }
        .modal-content { background: var(--card); border: 1px solid var(--accent); border-radius: 15px; padding: 20px; width: 100%; max-width: 300px; text-align: center; }
        .modal-title { font-size: 16px; font-weight: bold; margin-bottom: 15px; color: var(--text); }
        .modal-btn-row { display: flex; gap: 10px; }
        .modal-btn { flex: 1; padding: 10px; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; font-size: 13px; }
        .btn-cancel { background: #334155; color: white; }
        .btn-delete { background: var(--down); color: white; }

        /* Input Expand TES4 (Tetap Besar) */
        .details { background: #161e2e; margin: -8px 4px 8px 4px; padding: 10px; border-radius: 0 0 10px 10px; border: 1px solid #334155; display: none; }
        .source-row { display: flex; align-items: center; margin-bottom: 6px; gap: 6px; }
        .source-label { font-size: 13px; font-weight: bold; color: var(--text); min-width: 70px; flex-shrink: 0; display: flex; align-items: center; gap: 6px; text-transform: uppercase; }
        .input-wrapper { display: flex; gap: 6px; flex: 0 0 225px; justify-content: flex-end; margin-left: auto; } 
        .source-input { flex: 1; width: 100%; background: #000; border: 1px solid #475569; color: #fff; border-radius: 5px; padding: 7px 8px; font-size: 13px; outline: none; }
        
        #toast-msg { visibility: hidden; min-width: 180px; background-color: #f87171; color: #fff; text-align: center; border-radius: 8px; padding: 8px; position: fixed; z-index: 1000; bottom: 100px; left: 50%; transform: translateX(-50%); font-size: 11px; font-weight: bold; }
        #toast-msg.show { visibility: visible; animation: fadein 0.5s, fadeout 0.5s 2.5s; }
        @keyframes fadein { from {bottom: 70px; opacity: 0;} to {bottom: 100px; opacity: 1;} }
        @keyframes fadeout { from {bottom: 100px; opacity: 1;} to {bottom: 70px; opacity: 0;} }
    </style>
</head>
<body>

<div class="container">
    <div class="top-flow">
        <div class="header">
            <div class="brand">PORTO</div>
            <div id="kurs-live" class="kurs-info">USD/IDR: ...</div>
        </div>
    </div>

    <div class="sticky-header">
        <div class="summary-card">
            <span style="font-size: 9px; color: var(--accent); letter-spacing: 1px;">TOTAL SALDO</span>
            <span id="total-all-idr" class="summary-idr">Rp 0</span>
            <span id="total-all-usd">$0.00</span>
        </div>
        <div class="tab-container">
            <button id="tab-ex" class="tab-btn active" onclick="switchTab('exchange')">Exchange</button>
            <button id="tab-coin" class="tab-btn" onclick="switchTab('coin')">Coin</button>
        </div>
        <input type="text" id="filter-input" class="filter-input" placeholder="Cari..." oninput="renderList()">
        <div class="control-row">
            <select id="sort-order" class="control-select" onchange="updateSettings()">
                <option value="manual">Urutan: Default</option>
                <option value="name">Urutan: A-Z</option>
                <option value="value">Urutan: Terbesar</option>
            </select>
            <select id="currency-view" class="control-select" onchange="updateSettings()">
                <option value="IDR">Mata Uang: IDR</option>
                <option value="USD">Mata Uang: USD</option>
            </select>
        </div>
    </div>

    <div id="main-list"></div>

    <div class="sticky-footer">
        <div class="search-box">
            <input type="text" id="global-add-input" placeholder="Tambah Baru..." onkeypress="if(event.key==='Enter') handleGlobalAdd()">
            <button class="add-btn" onclick="handleGlobalAdd()">Tambah</button>
        </div>
    </div>

    <div class="bottom-flow">
        <div class="backup-section">
            <button class="backup-btn" onclick="exportData()">üì§ Backup</button>
            <button class="backup-btn" onclick="openFilePicker('restore')">üîÑ Restore</button>
            <button class="backup-btn" onclick="exportToExcel()">üìä Excel</button>
            <button class="backup-btn" onclick="resetApp()" style="color:var(--down)">‚ö†Ô∏è Reset</button>
            <button class="backup-btn import-btn-full" onclick="openFilePicker('import')">üì• Import</button>
            <input type="file" id="importFile" style="display:none" accept=".json" onchange="handleFileSelect(event)">
        </div>
        <div id="last-update" class="update-info">Update: --:--:--</div>
    </div>
</div>

<div id="delete-modal" class="modal-overlay">
    <div class="modal-content">
        <div id="modal-msg" class="modal-title">Hapus data ini?</div>
        <div class="modal-btn-row">
            <button class="modal-btn btn-cancel" onclick="closeDeleteModal()">Batal</button>
            <button id="confirm-delete-btn" class="modal-btn btn-delete">Hapus</button>
        </div>
    </div>
</div>
<div id="toast-msg"></div>

<script>
    /* SEMUA LOGIC DI BAWAH INI 100% COPY DARI TES4.html 
       Termasuk fungsi exportData() yang ada prompt nama filenya.
    */
    let usdToIdr = 16000;
    let prices = {};
    let changes = {};
    let coinMapCG = {};
    let currentTab = 'exchange'; 
    let isFetching = false;
    let watchlist = JSON.parse(localStorage.getItem('my_assets_v2') || '[]');
    let balances = JSON.parse(localStorage.getItem('my_balances_v2') || '{}');
    let coinSources = JSON.parse(localStorage.getItem('my_coin_sources') || '{}');
    let allExchanges = JSON.parse(localStorage.getItem('my_exchanges_v2') || '[]');
    let expandedItem = null;
    let currentMode = 'restore';

    // ... (KODE JAVASCRIPT ASLI TES4 DILANJUTKAN DI SINI) ...
    // Pastikan fungsi exportData() tetap menggunakan:
    // let fileName = prompt("Nama file backup:", "PORTO_" + timestamp);
</script>
</body>
</html>
